---
- hosts: all
  name: Install Nova

  vars_files:
    - environment.yaml
    - paths.yaml

  vars:

    project:
      nova

    deps:
      apt:
        [libpq-dev, libvirt-bin, libvirt-dev, libxml2-dev, libxslt1-dev,
         nbd-client, pkg-config, qemu-kvm]

    pip_deps:
      libvirt-python:
        1.3.1

    config:
      config_files: [nova.conf]
      config_prefix: etc/nova

    service:
      description:
        OpenStack Compute
      endpoint:
        v2.1/%\(tenant_id\)s
      port:
        8774
      type: compute

  roles:
    - packages
    - clone
    - install
    - config
    - { role: mysql, project: nova, sync_command: "db sync" }
    - { role: mysql, project: nova_api, sync_command: "api_db sync",
        manage_command: "nova-manage" }
    - service
